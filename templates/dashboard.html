<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  {% if theme == 'dark' %}
        <link rel="stylesheet" href="{{ url_for('static', filename='CSS/dark.css') }}">
  {% else %}
        <link rel="stylesheet" href="{{ url_for('static', filename='CSS/style.css') }}">
  {% endif %}
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Protest+Guerrilla&family=Russo+One&display=swap" rel="stylesheet">
  <title>Dashboard</title>
</head>

<body>
  <div id="dashboard" style="background-image: url('{{ wallpaper }}');">
    <div id="top">
      <div id="usage" onclick="">
        <img style="margin-left: 0vw;" src="{{ url_for('static', filename='icons/cpu.png') }}" alt="CPU Usage">
        {{ cpu_usage }}%
        <img src="{{ url_for('static', filename='icons/ram.png') }}" alt="RAM Usage">
        {{ ram_usage }}%
        <img src="{{ url_for('static', filename='icons/wifi.png') }}" alt="WiFi Signal">
        {{ wifi_signal }}%
      </div>
      <div id="clock"></div>
      <div id="date"></div>
    </div>
    <div id="bar">
      <div id="task-bar">
        <div class="app" onclick="toggleApp('prompt');">
          <img src="{{ url_for('static', filename='icons/prompt.png') }}" alt="Prompt">
        </div>
        <div class="app" onclick="toggleApp('settings');">
          <img src="{{ url_for('static', filename='icons/settings.png') }}" alt="Settings">
        </div>
        <div class="app" onclick="toggleApp('files');">
          <img src="{{ url_for('static', filename='icons/files.png') }}" alt="Files">
        </div>
        <div class="app" onclick="toggleApp('webcams');">
          <img src="{{ url_for('static', filename='icons/cctv-camera.png') }}" alt="Webcams">
        </div>
        <div class="app" onclick="toggleApp('apps');">
          <img src="{{ url_for('static', filename='icons/apps.png') }}" alt="Apps">
        </div>
        <div class="app" onclick="toggleApp('store');">
          <img src="{{ url_for('static', filename='icons/shop.png') }}" alt="Store">
        </div>
      </div>
    </div>
    <div id="open"></div>
  </div>

  <script>
    // Initialize variables
    let appRun = false;

    // Update time and date
    function updateTime() {
      const now = new Date();
      const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
      document.getElementById("clock").innerHTML = timeString;
      setTimeout(updateTime, 1000);
    }

    function updateDate() {
      const now = new Date();
      const dateString = now.toLocaleDateString();
      document.getElementById("date").innerHTML = dateString;
      setTimeout(updateDate, 1000);
    }

    // Toggle application display
    function toggleApp(app) {
      const iframe = document.getElementById("iframe");
      if (!appRun) {
        document.getElementById("open").innerHTML = `<iframe id='iframe' src='./${app}' frameborder='0'></iframe>`;
        setTimeout(() => {
          iframe.style.transform = "translateY(0%) scale(1)";
        }, 10);
      } else {
        setTimeout(() => {
          iframe.style.transform = "translateY(90%) scale(0.2)";
          setTimeout(() => {
            iframe.style.visibility = "hidden";
          }, 900);
        }, 10);
      }
      appRun = !appRun;
    }

    // Start the time and date updates
    updateTime();
    updateDate();
  </script>
</body>

</html>